<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Smart Wall Socket Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    
    .price-setting {
      background: rgba(255,255,255,0.95);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }
    
    .price-setting h3 {
      margin-bottom: 15px;
      color: #333;
    }
    
    .price-input {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .price-input label {
      font-weight: 600;
    }
    
    .price-input input {
      padding: 10px 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      width: 150px;
    }
    
    .price-input button {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    
    .price-input button:hover {
      background: #5a6fd8;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .socket-card {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .socket-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    
    .socket-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .socket-header h3 {
      font-size: 1.4rem;
      color: #333;
    }
    
    .status-indicator {
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
    }
    
    .status-on {
      background: #4caf50;
      color: white;
    }
    
    .status-off {
      background: #f44336;
      color: white;
    }
    
    .power-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #667eea;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: #666;
      margin-top: 5px;
    }
    
    .toggle-button {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
    }
    
    .toggle-on {
      background: #4caf50;
      color: white;
    }
    
    .toggle-off {
      background: #f44336;
      color: white;
    }
    
    .toggle-button:hover {
      opacity: 0.9;
      transform: scale(1.02);
    }
    
    .charts-section {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }
    
    .charts-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .charts-header h2 {
      font-size: 2rem;
      color: #333;
      margin-bottom: 10px;
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    
    .chart-container {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .chart-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      text-align: center;
      color: #333;
    }
    
    .chart {
      width: 100%;
      height: 250px;
      position: relative;
    }
    
    .usage-bars {
      display: flex;
      align-items: end;
      height: 200px;
      gap: 20px;
      padding: 20px 0;
    }
    
    .usage-bar {
      flex: 1;
      background: linear-gradient(to top, #667eea, #764ba2);
      border-radius: 8px 8px 0 0;
      position: relative;
      min-height: 20px;
      transition: all 0.3s;
    }
    
    .usage-bar:hover {
      transform: scale(1.05);
    }
    
    .bar-label {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    .bar-value {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8rem;
      font-weight: 600;
      color: #667eea;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .control-btn {
      padding: 15px 30px;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
    }
    
    .all-off-btn {
      background: #f44336;
      color: white;
    }
    
    .all-on-btn {
      background: #4caf50;
      color: white;
    }
    
    .control-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .total-usage {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }
    
    .total-usage h2 {
      font-size: 2rem;
      color: #333;
      margin-bottom: 20px;
    }
    
    .total-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .total-stat {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .total-stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .total-stat-label {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .price-input {
        flex-direction: column;
        align-items: stretch;
      }
      
      .price-input input {
        width: 100%;
      }
      
      .controls {
        flex-direction: column;
      }
      
      .control-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üè† Smart Wall Socket Dashboard</h1>
      <p>Monitor and control your IoT-enabled wall sockets</p>
    </div>
    
    <div class="price-setting">
      <h3>‚ö° Electricity Rate Setting</h3>
      <div class="price-input">
        <label>Price per kWh:</label>
        <input type="number" id="pricePerUnit" value="0.15" step="0.01" min="0">
        <span>USD</span>
        <button onclick="updatePricing()">Update Rate</button>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="socket-card">
        <div class="socket-header">
          <h3>üîå Socket 1</h3>
          <div class="status-indicator" id="status1">OFF</div>
        </div>
        <div class="power-stats">
          <div class="stat-item">
            <div class="stat-value" id="current1">0.0</div>
            <div class="stat-label">Current (A)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="voltage1">0</div>
            <div class="stat-label">Voltage (V)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="power1">0.0</div>
            <div class="stat-label">Power (W)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="cost1">$0.00</div>
            <div class="stat-label">Daily Cost</div>
          </div>
        </div>
        <button class="toggle-button toggle-off" id="btn1" onclick="toggleRelay(1)">Turn ON</button>
      </div>
      
      <div class="socket-card">
        <div class="socket-header">
          <h3>üîå Socket 2</h3>
          <div class="status-indicator" id="status2">OFF</div>
        </div>
        <div class="power-stats">
          <div class="stat-item">
            <div class="stat-value" id="current2">0.0</div>
            <div class="stat-label">Current (A)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="voltage2">0</div>
            <div class="stat-label">Voltage (V)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="power2">0.0</div>
            <div class="stat-label">Power (W)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="cost2">$0.00</div>
            <div class="stat-label">Daily Cost</div>
          </div>
        </div>
        <button class="toggle-button toggle-off" id="btn2" onclick="toggleRelay(2)">Turn ON</button>
      </div>
      
      <div class="socket-card">
        <div class="socket-header">
          <h3>üîå Socket 3</h3>
          <div class="status-indicator" id="status3">OFF</div>
        </div>
        <div class="power-stats">
          <div class="stat-item">
            <div class="stat-value" id="current3">0.0</div>
            <div class="stat-label">Current (A)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="voltage3">0</div>
            <div class="stat-label">Voltage (V)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="power3">0.0</div>
            <div class="stat-label">Power (W)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="cost3">$0.00</div>
            <div class="stat-label">Daily Cost</div>
          </div>
        </div>
        <button class="toggle-button toggle-off" id="btn3" onclick="toggleRelay(3)">Turn ON</button>
      </div>
      
      <div class="socket-card">
        <div class="socket-header">
          <h3>üîå Socket 4</h3>
          <div class="status-indicator" id="status4">OFF</div>
        </div>
        <div class="power-stats">
          <div class="stat-item">
            <div class="stat-value" id="current4">0.0</div>
            <div class="stat-label">Current (A)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="voltage4">0</div>
            <div class="stat-label">Voltage (V)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="power4">0.0</div>
            <div class="stat-label">Power (W)</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="cost4">$0.00</div>
            <div class="stat-label">Daily Cost</div>
          </div>
        </div>
        <button class="toggle-button toggle-off" id="btn4" onclick="toggleRelay(4)">Turn ON</button>
      </div>
    </div>
    
    <div class="controls">
      <button class="control-btn all-on-btn" onclick="allOn()">üîã All ON</button>
      <button class="control-btn all-off-btn" onclick="allOff()">‚ö° All OFF</button>
    </div>
    
    <div class="charts-section">
      <div class="charts-header">
        <h2>üìä Power Usage Analytics</h2>
        <p>Real-time monitoring and usage comparison</p>
      </div>
      <div class="charts-grid">
        <div class="chart-container">
          <div class="chart-title">Power Consumption Comparison</div>
          <div class="chart">
            <div class="usage-bars">
              <div class="usage-bar" id="bar1">
                <div class="bar-label">Socket 1</div>
                <div class="bar-value" id="barValue1">0W</div>
              </div>
              <div class="usage-bar" id="bar2">
                <div class="bar-label">Socket 2</div>
                <div class="bar-value" id="barValue2">0W</div>
              </div>
              <div class="usage-bar" id="bar3">
                <div class="bar-label">Socket 3</div>
                <div class="bar-value" id="barValue3">0W</div>
              </div>
              <div class="usage-bar" id="bar4">
                <div class="bar-label">Socket 4</div>
                <div class="bar-value" id="barValue4">0W</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="chart-container">
          <div class="chart-title">Highest Usage Socket</div>
          <div class="chart" style="display: flex; align-items: center; justify-content: center; flex-direction: column;">
            <div style="font-size: 3rem; margin-bottom: 10px;">üèÜ</div>
            <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;" id="highestUsage">Socket 1</div>
            <div style="font-size: 1.2rem; color: #666;" id="highestUsageValue">0W</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="total-usage">
      <h2>üìà Total System Usage</h2>
      <div class="total-stats">
        <div class="total-stat">
          <div class="total-stat-value" id="totalPower">0</div>
          <div class="total-stat-label">Total Power (W)</div>
        </div>
        <div class="total-stat">
          <div class="total-stat-value" id="totalCost">$0.00</div>
          <div class="total-stat-label">Daily Cost</div>
        </div>
        <div class="total-stat">
          <div class="total-stat-value" id="activeCount">0</div>
          <div class="total-stat-label">Active Sockets</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDRobNTnJIGFKeLQgg3qvtmGYyBA52OvLk",
      authDomain: "iot-plug-5a896.firebaseapp.com",
      databaseURL: "https://iot-plug-5a896-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "iot-plug-5a896",
      storageBucket: "iot-plug-5a896.firebasestorage.app",
      messagingSenderId: "751077979174",
      appId: "1:751077979174:web:5763486777df938f7062e7"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Global variables
    let pricePerKWh = 0.15;
    let relayStates = [false, false, false, false];
    let powerData = [0, 0, 0, 0];

    // Initialize the dashboard
    function initializeDashboard() {
      const relays = [
        { id: 1, path: "relay1" },
        { id: 2, path: "relay2" },
        { id: 3, path: "relay3" },
        { id: 4, path: "relay4" }
      ];

      relays.forEach(relay => {
        // Listen to relay state changes
        const relayRef = db.ref("/" + relay.path);
        relayRef.on("value", (snapshot) => {
          const state = snapshot.val();
          relayStates[relay.id - 1] = state;
          updateRelayUI(relay.id, state);
        });

        // Listen to sensor data (simulated for now)
        listenToSensorData(relay.id);
      });

      // Start simulation of sensor data
      startSensorSimulation();
    }

    function updateRelayUI(relayId, state) {
      const statusElement = document.getElementById(`status${relayId}`);
      const buttonElement = document.getElementById(`btn${relayId}`);
      
      if (state) {
        statusElement.textContent = "ON";
        statusElement.className = "status-indicator status-on";
        buttonElement.textContent = "Turn OFF";
        buttonElement.className = "toggle-button toggle-on";
      } else {
        statusElement.textContent = "OFF";
        statusElement.className = "status-indicator status-off";
        buttonElement.textContent = "Turn ON";
        buttonElement.className = "toggle-button toggle-off";
      }
    }

    function toggleRelay(relayId) {
      const relayRef = db.ref(`/relay${relayId}`);
      relayRef.get().then(snap => {
        relayRef.set(!snap.val());
      });
    }

    function allOn() {
      for (let i = 1; i <= 4; i++) {
        db.ref(`/relay${i}`).set(true);
      }
    }

    function allOff() {
      for (let i = 1; i <= 4; i++) {
        db.ref(`/relay${i}`).set(false);
      }
    }

    function listenToSensorData(relayId) {
      // Listen to current data
      db.ref(`/sensors/current${relayId}`).on("value", (snapshot) => {
        const current = snapshot.val() || 0;
        document.getElementById(`current${relayId}`).textContent = current.toFixed(2);
        updatePowerCalculations(relayId);
      });

      // Listen to voltage data
      db.ref(`/sensors/voltage${relayId}`).on("value", (snapshot) => {
        const voltage = snapshot.val() || 0;
        document.getElementById(`voltage${relayId}`).textContent = voltage.toFixed(0);
        updatePowerCalculations(relayId);
      });
    }

    function updatePowerCalculations(relayId) {
      const current = parseFloat(document.getElementById(`current${relayId}`).textContent);
      const voltage = parseFloat(document.getElementById(`voltage${relayId}`).textContent);
      const power = current * voltage;
      
      powerData[relayId - 1] = relayStates[relayId - 1] ? power : 0;
      
      document.getElementById(`power${relayId}`).textContent = powerData[relayId - 1].toFixed(1);
      
      // Calculate daily cost (assuming 24 hours usage)
      const dailyKWh = (powerData[relayId - 1] * 24) / 1000;
      const dailyCost = dailyKWh * pricePerKWh;
      document.getElementById(`cost${relayId}`).textContent = `$${dailyCost.toFixed(2)}`;
      
      updateCharts();
      updateTotalUsage();
    }

    function updateCharts() {
      const maxPower = Math.max(...powerData) || 1;
      
      for (let i = 1; i <= 4; i++) {
        const bar = document.getElementById(`bar${i}`);
        const barValue = document.getElementById(`barValue${i}`);
        const height = (powerData[i - 1] / maxPower) * 180 + 20;
        
        bar.style.height = `${height}px`;
        barValue.textContent = `${powerData[i - 1].toFixed(1)}W`;
      }
      
      // Update highest usage
      const maxIndex = powerData.indexOf(Math.max(...powerData));
      document.getElementById('highestUsage').textContent = `Socket ${maxIndex + 1}`;
      document.getElementById('highestUsageValue').textContent = `${powerData[maxIndex].toFixed(1)}W`;
    }

    function updateTotalUsage() {
      const totalPower = powerData.reduce((sum, power) => sum + power, 0);
      const totalDailyKWh = (totalPower * 24) / 1000;
      const totalDailyCost = totalDailyKWh * pricePerKWh;
      const activeCount = relayStates.filter(state => state).length;
      
      document.getElementById('totalPower').textContent = totalPower.toFixed(1);
      document.getElementById('totalCost').textContent = `$${totalDailyCost.toFixed(2)}`;
      document.getElementById('activeCount').textContent = activeCount;
    }

    function updatePricing() {
      pricePerKWh = parseFloat(document.getElementById('pricePerUnit').value) || 0.15;
      
      // Recalculate all costs
      for (let i = 1; i <= 4; i++) {
        updatePowerCalculations(i);
      }
    }

    function startSensorSimulation() {
      // Simulate sensor data updates
      setInterval(() => {
        for (let i = 1; i <= 4; i++) {
          if (relayStates[i - 1]) {
            // Simulate realistic power consumption when device is ON
            const baseCurrent = 0.5 + Math.random() * 2; // 0.5 to 2.5 A
            const voltage = 220 + Math.random() * 20 - 10; // 210 to 230 V
            
            db.ref(`/sensors/current${i}`).set(baseCurrent);
            db.ref(`/sensors/voltage${i}`).set(voltage);
          } else {
            // No power consumption when OFF
            db.ref(`/sensors/current${i}`).set(0);
            db.ref(`/sensors/voltage${i}`).set(0);
          }
        }
      }, 2000); // Update every 2 seconds
    }

    // Initialize dashboard when page loads
    window.addEventListener('load', initializeDashboard);
  </script>
</body>
</html>
