<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Smart Wall Socket Controller</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .header {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 20px 0;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header h1 {
      color: white;
      font-size: 2.2rem;
      font-weight: 300;
      margin-bottom: 5px;
    }

    .header p {
      color: rgba(255, 255, 255, 0.8);
      font-size: 1rem;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    /* Login Form Styles */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 80vh;
    }

    .login-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .login-card h2 {
      margin-bottom: 30px;
      color: #333;
      font-weight: 300;
    }

    .input-group {
      position: relative;
      margin-bottom: 20px;
    }

    .input-group input {
      width: 100%;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
    }

    .input-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
    }

    .login-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    /* Dashboard Styles */
    #dashboard {
      display: none;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 20px;
      border-radius: 25px;
      color: white;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      background: #4CAF50;
      border-radius: 50%;
      margin-right: 10px;
      animation: pulse 2s infinite;
    }

    .settings-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .settings-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    /* Overview Cards */
    .overview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .overview-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .overview-card h4 {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .overview-card .value {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .overview-card .unit {
      color: #888;
      font-size: 0.9rem;
    }

    .total-power .value { color: #FF9800; }
    .total-cost .value { color: #4CAF50; }
    .highest-usage .value { color: #2196F3; }
    .active-devices .value { color: #9C27B0; }

    /* Socket Cards Grid */
    .sockets-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .socket-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .socket-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }

    .socket-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .socket-info {
      display: flex;
      align-items: center;
    }

    .socket-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      color: white;
      font-size: 24px;
    }

    .socket-details h3 {
      font-size: 1.3rem;
      margin-bottom: 5px;
      color: #333;
    }

    .socket-status {
      font-size: 0.9rem;
      color: #666;
    }

    .toggle-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background: #ccc;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .toggle-switch.active {
      background: linear-gradient(135deg, #4CAF50, #45a049);
    }

    .toggle-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch.active .toggle-slider {
      transform: translateX(30px);
    }

    .device-name {
      background: #f5f5f5;
      padding: 10px 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: none;
      width: 100%;
      font-size: 14px;
    }

    .sensor-readings {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .reading-item {
      text-align: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .reading-value {
      font-size: 1.4rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .reading-label {
      font-size: 0.8rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .voltage .reading-value { color: #FF5722; }
    .current .reading-value { color: #2196F3; }
    .power .reading-value { color: #FF9800; }
    .cost .reading-value { color: #4CAF50; }

    .usage-chart {
      height: 120px;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 15px;
      position: relative;
      overflow: hidden;
    }

    .chart-canvas {
      width: 100%;
      height: 100%;
    }

    /* Charts Section */
    .charts-section {
      margin-bottom: 40px;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-top: 20px;
    }

    .chart-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .chart-card h3 {
      margin-bottom: 20px;
      color: #333;
      text-align: center;
    }

    .chart-container {
      height: 300px;
      position: relative;
    }

    /* Settings Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    }

    .modal h3 {
      margin-bottom: 20px;
      color: #333;
    }

    .setting-item {
      margin-bottom: 20px;
    }

    .setting-item label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
    }

    .setting-item input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
    }

    .close-btn {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      margin-top: -10px;
    }

    .close-btn:hover {
      color: #000;
    }

    .save-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-top: 10px;
    }

    .control-buttons {
      display: flex;
      gap: 15px;
      margin-top: 40px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .control-btn {
      padding: 15px 30px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      color: white;
      min-width: 150px;
    }

    .all-off-btn {
      background: linear-gradient(135deg, #f44336, #d32f2f);
    }

    .all-off-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(244, 67, 54, 0.4);
    }

    .logout-btn {
      background: linear-gradient(135deg, #757575, #424242);
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(117, 117, 117, 0.4);
    }

    .schedule-btn {
      background: linear-gradient(135deg, #FF9800, #F57C00);
    }

    .schedule-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 152, 0, 0.4);
    }

    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8rem;
      }
      
      .sockets-grid {
        grid-template-columns: 1fr;
      }
      
      .charts-grid {
        grid-template-columns: 1fr;
      }
      
      .overview-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .control-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .control-btn {
        width: 100%;
        max-width: 300px;
      }

      .sensor-readings {
        grid-template-columns: 1fr;
      }
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>⚡ Smart Wall Socket Controller</h1>
    <p>Real-time power monitoring and control</p>
  </div>

  <!-- Login Form -->
  <div id="loginForm" class="login-container">
    <div class="login-card">
      <h2>🔐 Secure Access</h2>
      <div class="input-group">
        <input type="email" id="email" placeholder="Email Address" required />
      </div>
      <div class="input-group">
        <input type="password" id="password" placeholder="Password" required />
      </div>
      <button id="loginBtn" class="login-btn">Login to Dashboard</button>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard">
    <div class="container">
      <div class="dashboard-header">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span>System Online</span>
        </div>
        <button id="settingsBtn" class="settings-btn">⚙️ Settings</button>
      </div>

      <!-- Overview Cards -->
      <div class="overview-grid">
        <div class="overview-card total-power">
          <h4>Total Power</h4>
          <div class="value" id="totalPower">0</div>
          <div class="unit">Watts</div>
        </div>
        <div class="overview-card total-cost">
          <h4>Daily Cost</h4>
          <div class="value" id="totalCost">$0.00</div>
          <div class="unit">USD</div>
        </div>
        <div class="overview-card highest-usage">
          <h4>Highest Usage</h4>
          <div class="value" id="highestUsage">Socket 1</div>
          <div class="unit">Current Leader</div>
        </div>
        <div class="overview-card active-devices">
          <h4>Active Devices</h4>
          <div class="value" id="activeDevices">0</div>
          <div class="unit">Running Now</div>
        </div>
      </div>

      <!-- Socket Cards -->
      <div class="sockets-grid">
        <div class="socket-card">
          <div class="socket-header">
            <div class="socket-info">
              <div class="socket-icon">🔌</div>
              <div class="socket-details">
                <h3>Socket 1</h3>
                <div class="socket-status">Status: <span id="status1">Loading...</span></div>
              </div>
            </div>
            <div class="toggle-switch" id="toggle1">
              <div class="toggle-slider"></div>
            </div>
          </div>
          <input type="text" class="device-name" id="device1" placeholder="Device name (e.g., Living Room Lamp)" />
          
          <div class="sensor-readings">
            <div class="reading-item voltage">
              <div class="reading-value" id="voltage1">0V</div>
              <div class="reading-label">Voltage</div>
            </div>
            <div class="reading-item current">
              <div class="reading-value" id="current1">0A</div>
              <div class="reading-label">Current</div>
            </div>
            <div class="reading-item power">
              <div class="reading-value" id="power1">0W</div>
              <div class="reading-label">Power</div>
            </div>
            <div class="reading-item cost">
              <div class="reading-value" id="cost1">$0.00</div>
              <div class="reading-label">Daily Cost</div>
            </div>
          </div>

          <div class="usage-chart">
            <canvas class="chart-canvas" id="chart1"></canvas>
          </div>
        </div>

        <div class="socket-card">
          <div class="socket-header">
            <div class="socket-info">
              <div class="socket-icon">🔌</div>
              <div class="socket-details">
                <h3>Socket 2</h3>
                <div class="socket-status">Status: <span id="status2">Loading...</span></div>
              </div>
            </div>
            <div class="toggle-switch" id="toggle2">
              <div class="toggle-slider"></div>
            </div>
          </div>
          <input type="text" class="device-name" id="device2" placeholder="Device name (e.g., Coffee Maker)" />
          
          <div class="sensor-readings">
            <div class="reading-item voltage">
              <div class="reading-value" id="voltage2">0V</div>
              <div class="reading-label">Voltage</div>
            </div>
            <div class="reading-item current">
              <div class="reading-value" id="current2">0A</div>
              <div class="reading-label">Current</div>
            </div>
            <div class="reading-item power">
              <div class="reading-value" id="power2">0W</div>
              <div class="reading-label">Power</div>
            </div>
            <div class="reading-item cost">
              <div class="reading-value" id="cost2">$0.00</div>
              <div class="reading-label">Daily Cost</div>
            </div>
          </div>

          <div class="usage-chart">
            <canvas class="chart-canvas" id="chart2"></canvas>
          </div>
        </div>

        <div class="socket-card">
          <div class="socket-header">
            <div class="socket-info">
              <div class="socket-icon">🔌</div>
              <div class="socket-details">
                <h3>Socket 3</h3>
                <div class="socket-status">Status: <span id="status3">Loading...</span></div>
              </div>
            </div>
            <div class="toggle-switch" id="toggle3">
              <div class="toggle-slider"></div>
            </div>
          </div>
          <input type="text" class="device-name" id="device3" placeholder="Device name (e.g., Fan)" />
          
          <div class="sensor-readings">
            <div class="reading-item voltage">
              <div class="reading-value" id="voltage3">0V</div>
              <div class="reading-label">Voltage</div>
            </div>
            <div class="reading-item current">
              <div class="reading-value" id="current3">0A</div>
              <div class="reading-label">Current</div>
            </div>
            <div class="reading-item power">
              <div class="reading-value" id="power3">0W</div>
              <div class="reading-label">Power</div>
            </div>
            <div class="reading-item cost">
              <div class="reading-value" id="cost3">$0.00</div>
              <div class="reading-label">Daily Cost</div>
            </div>
          </div>

          <div class="usage-chart">
            <canvas class="chart-canvas" id="chart3"></canvas>
          </div>
        </div>

        <div class="socket-card">
          <div class="socket-header">
            <div class="socket-info">
              <div class="socket-icon">🔌</div>
              <div class="socket-details">
                <h3>Socket 4</h3>
                <div class="socket-status">Status: <span id="status4">Loading...</span></div>
              </div>
            </div>
            <div class="toggle-switch" id="toggle4">
              <div class="toggle-slider"></div>
            </div>
          </div>
          <input type="text" class="device-name" id="device4" placeholder="Device name (e.g., Air Purifier)" />
          
          <div class="sensor-readings">
            <div class="reading-item voltage">
              <div class="reading-value" id="voltage4">0V</div>
              <div class="reading-label">Voltage</div>
            </div>
            <div class="reading-item current">
              <div class="reading-value" id="current4">0A</div>
              <div class="reading-label">Current</div>
            </div>
            <div class="reading-item power">
              <div class="reading-value" id="power4">0W</div>
              <div class="reading-label">Power</div>
            </div>
            <div class="reading-item cost">
              <div class="reading-value" id="cost4">$0.00</div>
              <div class="reading-label">Daily Cost</div>
            </div>
          </div>

          <div class="usage-chart">
            <canvas class="chart-canvas" id="chart4"></canvas>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <div class="charts-grid">
          <div class="chart-card">
            <h3>📊 Power Usage Comparison</h3>
            <div class="chart-container">
              <canvas id="comparisonChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h3>💰 Cost Analysis</h3>
            <div class="chart-container">
              <canvas id="costChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="control-buttons">
        <button id="allOffBtn" class="control-btn all-off-btn">🚫 All OFF</button>
        <button id="scheduleBtn" class="control-btn schedule-btn">⏰ Schedule</button>
        <button id="logoutBtn" class="control-btn logout-btn">🚪 Logout</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeSettings">&times;</span>
      <h3>⚙️ Power Settings</h3>
      <div class="setting-item">
        <label for="pricePerUnit">Price per kWh (USD):</label>
        <input type="number" id="pricePerUnit" step="0.01" value="0.12" min="0" />
      </div>
      <div class="setting-item">
        <label for="currency">Currency:</label>
        <input type="text" id="currency" value="$" maxlength="3" />
      </div>
      <div class="setting-item">
        <label for="updateInterval">Update Interval (seconds):</label>
        <input type="number" id="updateInterval" value="2" min="1" max="60" />
      </div>
      <button class="save-btn" id="saveSettings">Save Settings</button>
    </div>
  </div>

  <div class="footer">
    <p>Smart Wall Socket System | Real-time Power Monitoring</p>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDRobNTnJIGFKeLQgg3qvtmGYyBA52OvLk",
      authDomain: "iot-plug-5a896.firebaseapp.com",
      databaseURL: "https://iot-plug-5a896-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "iot-plug-5a896",
      storageBucket: "iot-plug-5a896.firebasestorage.app",
      messagingSenderId: "751077979174",
      appId: "1:751077979174:web:5763486777df938f7062e7"
    };

    firebase.initializeApp(firebaseConfig);

    // Global variables
    const allowedEmail = "jimalkaperera@gmail.com";
    const allowedPassword = "Jinalka@1999";
    
    let pricePerUnit = 0.12; // USD per kWh
    let currency = "$";
    let updateInterval = 2000; // 2 seconds
    let deviceNames = {};
    let powerData = {};
    let charts = {};
    let comparisonChart = null;
    let costChart = null;

    const loginForm = document.getElementById("loginForm");
    const dashboard = document.getElementById("dashboard");
    const loginBtn = document.getElementById("loginBtn");
    const settingsModal = document.getElementById("settingsModal");

    // Initialize power data
    for (let i = 1; i <= 4; i++) {
      powerData[i] = {
        voltage: 0,
        current: 0,
        power: 0,
        dailyUsage: 0,
        history: []
      };
    }

    // Login functionality
    loginBtn.addEventListener("click", handleLogin);
    document.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && loginForm.style.display !== "none") {
        handleLogin();
      }
    });

    function handleLogin() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      if (!email || !password) {
        alert("Please enter email and password.");
        return;
      }

      loginBtn.innerHTML = '<div class="loading"></div> Connecting...';
      loginBtn.disabled = true;

      if (email === allowedEmail && password === allowedPassword) {
        firebase.auth().signInWithEmailAndPassword(email, password)
          .then(userCredential => {
            console.log("Signed in as", userCredential.user.email);
            loginForm.style.display = "none";
            dashboard.style.display = "block";
            startSmartSocketControl();
          })
          .catch(error => {
            alert("Firebase login failed: " + error.message);
            resetLoginButton();
          });
      } else {
        alert("Invalid email or password.");
        resetLoginButton();